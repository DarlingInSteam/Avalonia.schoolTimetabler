using System.Collections.ObjectModel;using System.Reactive;using System.Reactive.Linq;using Data.Repositories;using Domain.Entities;using Domain.UseCases;using ReactiveUI;using ReactiveUI.Fody.Helpers;namespace SchoolTimetabler.ViewModels;public class TimetableInfoViewModel : ViewModelBase, IRoutableViewModel, IScreen{    private int _countDays;    [Reactive] public string DayOfTheWeek { get; set; } = "Понедельник";    [Reactive] public bool IsEnableBack { get; set; }    [Reactive] public bool IsEnableNext { get; set; } = true;    private int _selectedIndexComboBox;    private readonly TimetableInteractor _timetableInteractor;    public TimetableInfoViewModel()    {        _timetableInteractor = new TimetableInteractor(TimetablesRepository.GetInstance());        var classInteractor = new ClassInteractor(ClassesRepository.GetInstance());        Timetable = new ObservableCollection<Timetable>(_timetableInteractor.GetTimetable());        ClassesNumber = new ObservableCollection<string>();        Classes = new ObservableCollection<Class>(classInteractor.GetClasses());        ClassesNumbers = new ObservableCollection<string>();        TeacherName = new ObservableCollection<string>();        DisciplineName = new ObservableCollection<string>();        CabinetNumber = new ObservableCollection<string>();        foreach (var t in Classes) ClassesNumber.Add(t.Number + t.Symbol);        foreach (var t in Timetable)            if (t.ClassOne == ClassesNumber[SelectedIndexComboBox] && t.Day == DayOfTheWeek)            {                var l = _timetableInteractor.GetDisciplines(DayOfTheWeek, ClassesNumber[SelectedIndexComboBox]);                foreach (var q in _timetableInteractor.GetDisciplines(DayOfTheWeek,                             ClassesNumber[SelectedIndexComboBox]))                    DisciplineName.Add(q);                foreach (var w in _timetableInteractor.GetTeachers(DayOfTheWeek, ClassesNumber[SelectedIndexComboBox]))                    TeacherName.Add(w);                foreach (var e in _timetableInteractor.GetClasses(DayOfTheWeek, ClassesNumber[SelectedIndexComboBox]))                    ClassesNumbers.Add(e);                foreach (var y in _timetableInteractor.GetCabinets(DayOfTheWeek, ClassesNumber[SelectedIndexComboBox]))                    CabinetNumber.Add(y);                break;            }        DelTimetable = ReactiveCommand.Create(() =>        {            foreach (var timetable in Timetable)            {                if (timetable.Day == DayOfTheWeek && timetable.ClassOne == ClassesNumber[_selectedIndexComboBox])                    _timetableInteractor.DeleteTimetable(timetable);            }        });        BackDay = ReactiveCommand.Create(() =>        {            _countDays -= 1;            ChangeDayOfTheWeek();            RefreshListBox();        });        NextDay = ReactiveCommand.Create(() =>        {            _countDays += 1;            ChangeDayOfTheWeek();            RefreshListBox();        });    }    public ObservableCollection<Class> Classes { get; }    public ObservableCollection<string> ClassesNumber { get; set; }    public ObservableCollection<string> TeacherName { get; set; }    public ObservableCollection<string> DisciplineName { get; set; }    public ObservableCollection<string> CabinetNumber { get; set; }    public ObservableCollection<string> ClassesNumbers { get; set; }    public ObservableCollection<Timetable> Timetable { get; set; }    public ReactiveCommand<Unit, Unit> NextDay { get; }    public ReactiveCommand<Unit, Unit> BackDay { get; }    public ReactiveCommand<Unit, Unit> DelTimetable { get; }    public int SelectedIndexComboBox    {        set        {            this.RaiseAndSetIfChanged(ref _selectedIndexComboBox, value);            RefreshListBox();        }        get => _selectedIndexComboBox;    }    public string? UrlPathSegment { get; }    public IScreen HostScreen { get; }    public RoutingState Router { get; }    private void RefreshListBox()    {        DisciplineName.Clear();        TeacherName.Clear();        ClassesNumbers.Clear();        CabinetNumber.Clear();        foreach (var t in Timetable)            if (t.ClassOne == ClassesNumber[SelectedIndexComboBox] && t.Day == DayOfTheWeek)            {                foreach (var q in _timetableInteractor.GetDisciplines(DayOfTheWeek,                             ClassesNumber[SelectedIndexComboBox]))                    DisciplineName.Add(q);                foreach (var w in _timetableInteractor.GetTeachers(DayOfTheWeek, ClassesNumber[SelectedIndexComboBox]))                    TeacherName.Add(w);                foreach (var e in _timetableInteractor.GetClasses(DayOfTheWeek, ClassesNumber[SelectedIndexComboBox]))                    ClassesNumbers.Add(e);                foreach (var y in _timetableInteractor.GetCabinets(DayOfTheWeek, ClassesNumber[SelectedIndexComboBox]))                    CabinetNumber.Add(y);            }    }    private void ChangeDayOfTheWeek()    {        switch (_countDays)        {            case 0:            {                DayOfTheWeek = "Понедельник";                IsEnableBack = false;                break;            }            case 1:            {                DayOfTheWeek = "Вторник";                IsEnableBack = true;                break;            }            case 2:            {                DayOfTheWeek = "Среда";                break;            }            case 3:            {                DayOfTheWeek = "Четверг";                break;            }            case 4:            {                DayOfTheWeek = "Пятница";                IsEnableNext = true;                break;            }            case 5:            {                DayOfTheWeek = "Суббота";                IsEnableNext = false;                break;            }        }    }}